!function(t){t.fn.highlightTextarea=function(i){var e=["highlight","enable","disable","setOptions","setWords"],h=t(this).data("highlightTextarea");if(h&&"string"==typeof i){if(t.inArray(i,e)!==!1)return h[i].apply(h,Array.prototype.slice.call(arguments,1));throw'Method "'+i+'" does not exist on jQuery.highlightTextarea'}if(!(h||"object"!=typeof i&&i))return i||(i={}),i=t.extend({},t.fn.highlightTextarea.defaults,i),i.regParam=i.caseSensitive?"g":"gi",this.each(function(){var e=t(this).data("highlightTextarea");e||(e=new t.highlightTextarea(t(this),i),e.init(),t(this).data("highlightTextarea",e))})},t.fn.highlightTextarea.defaults={words:[],color:"#ffff00",caseSensitive:!0,resizable:!1,id:null,debug:!1},t.highlightTextarea=function(i,e){this.options=e,i instanceof jQuery?this.$textarea=i:this.$textarea=t(i),this.$main=null,this.$highlighterContainer=null,this.$highlighter=null,this.init=function(){this.$textarea.closest(".highlightTextarea").length<=0&&this.$textarea.wrap('<div class="highlightTextarea" />'),this.$main=this.$textarea.parent(".highlightTextarea"),this.$main.find(".highlighterContainer").length<=0&&this.$main.prepend('<div class="highlighterContainer"></div>'),this.$highlighterContainer=this.$main.children(".highlighterContainer"),this.$highlighterContainer.find(".highlighter").length<=0&&this.$highlighterContainer.html('<div class="highlighter"></div>'),this.$highlighter=this.$highlighterContainer.children(".highlighter"),null!=this.options.id&&this.$main.attr("id",this.options.id),this.updateCss(),this.bindEvents(),this.applyResizable(),this.highlight()},this.highlight=function(i){return null==i||0==i?this.applyText(this.$textarea.val()):this.condensator(t.proxy(function(){this.applyText(this.$textarea.val())},this),100,300),this.$textarea.data("highlightTextareaEvents")===!0},this.setOptions=function(i){return"object"!=typeof i&&(i={}),this.options=t.extend({},this.options,i),this.options.regParam=this.options.caseSensitive?"g":"gi",this.options.debug?this.$highlighter.addClass("debug"):this.$highlighter.removeClass("debug"),this.$textarea.data("highlightTextareaEvents")===!0&&(this.highlight(),!0)},this.setWords=function(t){return"string"==typeof t||t instanceof Array?"string"==typeof t&&(t=[t]):t=[],this.options.words=t,this.$textarea.data("highlightTextareaEvents")===!0&&(this.highlight(),!0)},this.bindEvents=function(){var i=this.$textarea.data("highlightTextareaEvents");"boolean"==typeof i&&i===!0||(this.$highlighter.on({"click.highlightTextarea":t.proxy(function(){this.$textarea.focus()},this)}),this.$textarea.on({"input.highlightTextarea":t.proxy(function(){this.highlight(!0)},this),"resize.highlightTextarea":t.proxy(function(){this.updateSizePosition(!0)},this),"scroll.highlightTextarea":t.proxy(function(){this.updateSizePosition()},this)}),this.$textarea.data("highlightTextareaEvents",!0))},this.unbindEvents=function(){this.$highlighter.off("click.highlightTextarea"),this.$textarea.off("input.highlightTextarea scroll.highlightTextarea resize.highlightTextarea"),this.$textarea.data("highlightTextareaEvents",!1)},this.enable=function(){this.bindEvents(),this.highlight()},this.disable=function(){this.unbindEvents(),this.$highlighter.html(this.html_entities(this.$textarea.val()))},this.updateCss=function(){this.cloneCss(this.$textarea,this.$main,["float","vertical-align"]),this.$main.css({width:this.$textarea.outerWidth(!0),height:this.$textarea.outerHeight(!0)}),this.cloneCss(this.$textarea,this.$highlighterContainer,["background","background-image","background-color","background-position","background-repeat","background-origin","background-clip","background-size","padding-top","padding-right","padding-bottom","padding-left"]),this.$highlighterContainer.css({top:this.toPx(this.$textarea.css("margin-top"))+this.toPx(this.$textarea.css("border-top-width")),left:this.toPx(this.$textarea.css("margin-left"))+this.toPx(this.$textarea.css("border-left-width")),width:this.$textarea.width(),height:this.$textarea.height()}),this.cloneCss(this.$textarea,this.$highlighter,["font-size","font-family","font-style","font-weight","line-height","vertical-align","word-spacing","text-align"]),this.$highlighter.css({width:this.$textarea.width(),height:this.$textarea.height()}),this.$textarea.css({background:"none"}),this.options.debug&&this.$highlighter.addClass("debug")},this.applyResizable=function(){this.options.resizable&&jQuery.ui&&this.$textarea.resizable({handles:"se",resize:t.proxy(function(){this.updateSizePosition(!0)},this)})},this.applyText=function(t){if(t=this.html_entities(t),this.options.words.length>0){replace=new Array;for(var i=0;i<this.options.words.length;i++)replace.push(this.html_entities(this.options.words[i]));t=t.replace(new RegExp("("+replace.join("|")+")",this.options.regParam),'<span class="highlight" style="background-color:'+this.options.color+';">$1</span>')}this.$highlighter.html(t),this.updateSizePosition()},this.updateSizePosition=function(t){if(t&&(this.$main.css({width:this.$textarea.outerWidth(!0),height:this.$textarea.outerHeight(!0)}),this.$highlighterContainer.css({width:this.$textarea.width(),height:this.$textarea.height()})),this.$textarea[0].clientHeight<this.$textarea[0].scrollHeight&&"hidden"!=this.$textarea.css("overflow")&&"hidden"!=this.$textarea.css("overflow-y")||"scroll"==this.$textarea.css("overflow")||"scroll"==this.$textarea.css("overflow-y"))var i=18;else var i=5;this.$highlighter.css({width:this.$textarea.width()-i,height:this.$textarea.height()+this.$textarea.scrollTop(),"padding-right":i,top:-this.$textarea.scrollTop()})},this.cloneCss=function(t,i,e){for(var h=0;h<e.length;h++)i.css(e[h],t.css(e[h]))},this.toPx=function(i){if(i!=i.replace("em","")){var e=parseFloat(i.replace("em","")),h=t('<div style="display:none;font-size:1em;margin:0;padding:0;height:auto;line-height:1;border:0;">&nbsp;</div>').appendTo("body"),s=h.height();return h.remove(),Math.round(e*s)}return i!=i.replace("px","")?parseInt(i.replace("px","")):parseInt(i)},this.html_entities=function(i){return i?t("<div />").text(i).html():""};var h=null,s=null;this.condensator=function(t,i,e){null==e&&(e=i);var a=new Date;clearTimeout(h),null==s&&(s=a.getTime()),a.getTime()-s>e?(t.call(),s=a.getTime()):h=setTimeout(t,i)}}}(jQuery);